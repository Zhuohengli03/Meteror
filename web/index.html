<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meteor Madness Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-meteor"></i> Meteor Madness Dashboard</h1>
                <p>Real-time visualization of NASA meteor and asteroid data</p>
                <div id="api-status" class="api-status" style="display: none;">
                    <span id="api-status-text"></span>
                    <button id="reset-api-key" class="btn-reset" style="display: none;">
                        <i class="fas fa-refresh"></i> Reset to Primary
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="overview">
                <i class="fas fa-chart-pie"></i> Overview
            </button>
            <button class="nav-tab" data-tab="prediction">
                <i class="fas fa-bullseye"></i> Prediction
            </button>
            <button class="nav-tab" data-tab="close-approaches">
                <i class="fas fa-satellite"></i> Close Approaches
            </button>
            <button class="nav-tab" data-tab="fireballs">
                <i class="fas fa-fire"></i> Fireballs
            </button>
            <button class="nav-tab" data-tab="near-earth">
                <i class="fas fa-globe"></i> Near Earth Objects
            </button>
            <button class="nav-tab" data-tab="natural-events">
                <i class="fas fa-globe-americas"></i> Natural Events
            </button>
            <button class="nav-tab" data-tab="simulation">
                <i class="fas fa-calculator"></i> Simulation
            </button>
        </nav>

        <!-- Loading indicator -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Loading meteor data...</p>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-satellite"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="close-approaches-count">-</h3>
                        <p>Close Approaches</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-fire"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="fireballs-count">-</h3>
                        <p>Fireballs Detected</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="hazardous-count">-</h3>
                        <p>Potentially Hazardous</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-calendar"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="last-updated">-</h3>
                        <p>Last Updated</p>
                    </div>
                </div>
            </div>

            <div class="summary-section">
                <div class="summary-card">
                    <h3><i class="fas fa-info-circle"></i> Data Summary</h3>
                    <div id="data-summary">
                        <p>Loading data summary...</p>
                    </div>
                </div>
            </div>

            <div class="date-ranges-section">
                <div class="date-ranges-card">
                    <h3><i class="fas fa-calendar-alt"></i> Data Time Ranges</h3>
                    <div class="date-ranges-grid">
                        <div class="date-range-item">
                            <div class="date-range-header">
                                <i class="fas fa-satellite"></i>
                                <strong>Close Approaches</strong>
                            </div>
                            <div class="date-range-details">
                                <p><strong>Time Range:</strong> ±1 month (60 days)</p>
                                <p><strong>Purpose:</strong> Upcoming & recent approaches</p>
                                <p><strong>Limit:</strong> 20 objects maximum (shows 20+ if more available)</p>
                                <p><strong>Distance:</strong> Within 0.05 AU</p>
                            </div>
                        </div>
                        
                        <div class="date-range-item">
                            <div class="date-range-header">
                                <i class="fas fa-fire"></i>
                                <strong>Fireballs</strong>
                            </div>
                            <div class="date-range-details">
                                <p><strong>Time Range:</strong> Past 1 year (365 days)</p>
                                <p><strong>Purpose:</strong> Historical fireball events</p>
                                <p><strong>Limit:</strong> 20 events maximum (shows 20+ if more available)</p>
                                <p><strong>Data:</strong> Energy, velocity, location</p>
                            </div>
                        </div>
                        
                        <div class="date-range-item">
                            <div class="date-range-header">
                                <i class="fas fa-globe"></i>
                                <strong>Near Earth Objects</strong>
                            </div>
                            <div class="date-range-details">
                                <p><strong>Time Range:</strong> ±2 days (4 days)</p>
                                <p><strong>Purpose:</strong> Recent & upcoming NEOs</p>
                                <p><strong>Limit:</strong> All available in range</p>
                                <p><strong>Focus:</strong> Hazard assessment</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="limits-note">
                        <p><i class="fas fa-info-circle"></i> <strong>Note:</strong> Close approaches and fireballs are both limited to 20 items to ensure optimal performance and focus on the most significant events. When exactly 20 items are shown, the display shows "20+" to indicate there may be more data available.</p>
                    </div>
                </div>
            </div>

        </div>

        <!-- Close Approaches Tab -->
        <div id="close-approaches" class="tab-content">
            <!-- Map Section -->
            <div class="tab-map-section">
                <h3><i class="fas fa-map"></i> Close Approaches Map</h3>
                <div id="close-approaches-map" class="tab-map"></div>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label for="date-range">Date Range:</label>
                    <input type="date" id="date-min" />
                    <span>to</span>
                    <input type="date" id="date-max" />
                </div>
                <div class="control-group">
                    <label for="distance-max">Max Distance (AU):</label>
                    <input type="number" id="distance-max" value="0.05" step="0.01" min="0.001" max="1" />
                </div>
                <div class="control-group">
                    <label for="limit">Limit:</label>
                    <input type="number" id="limit" value="15" min="1" max="100" />
                </div>
                <button id="fetch-approaches" class="btn-primary">
                    <i class="fas fa-search"></i> Fetch Data
                </button>
            </div>
            <div class="data-table-container">
                <table id="approaches-table" class="data-table">
                    <thead>
                        <tr>
                            <th>Object</th>
                            <th>Closest Time</th>
                            <th>Distance (AU)</th>
                            <th>Velocity (km/s)</th>
                            <th>Magnitude</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Fireballs Tab -->
        <div id="fireballs" class="tab-content">
            <!-- Map Section -->
            <div class="tab-map-section">
                <h3><i class="fas fa-map"></i> Fireballs Map</h3>
                <div id="fireballs-map" class="tab-map"></div>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label for="fireball-since">Since Date:</label>
                    <input type="date" id="fireball-since" />
                </div>
                <div class="control-group">
                    <label for="fireball-limit">Limit:</label>
                    <input type="number" id="fireball-limit" value="15" min="1" max="100" />
                </div>
                <button id="fetch-fireballs" class="btn-primary">
                    <i class="fas fa-fire"></i> Fetch Fireballs
                </button>
            </div>
            <div class="data-table-container">
                <table id="fireballs-table" class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Latitude</th>
                            <th>Longitude</th>
                            <th>Energy (J)</th>
                            <th>Velocity (km/s)</th>
                            <th>Altitude (km)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Near Earth Objects Tab -->
        <div id="near-earth" class="tab-content">
            <!-- Map Section -->
            <div class="tab-map-section">
                <h3><i class="fas fa-map"></i> Near Earth Objects Map</h3>
                <div id="near-earth-map" class="tab-map"></div>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label for="neo-start">Start Date:</label>
                    <input type="date" id="neo-start" />
                </div>
                <div class="control-group">
                    <label for="neo-end">End Date:</label>
                    <input type="date" id="neo-end" />
                </div>
                <button id="fetch-neos" class="btn-primary">
                    <i class="fas fa-globe"></i> Fetch NEOs
                </button>
            </div>
            <div class="data-table-container">
                <table id="neos-table" class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Name</th>
                            <th>Hazardous</th>
                            <th>Min Diameter (km)</th>
                            <th>Max Diameter (km)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Natural Events Tab -->
        <div id="natural-events" class="tab-content">
            <div class="controls">
                <div class="control-group">
                    <label for="event-days">Days Back:</label>
                    <input type="number" id="event-days" value="30" min="1" max="365" />
                </div>
                <div class="control-group">
                    <label for="event-limit">Limit:</label>
                    <input type="number" id="event-limit" value="50" min="1" max="200" />
                </div>
                <div class="control-group">
                    <label for="event-status">Status:</label>
                    <select id="event-status">
                        <option value="all">All Events</option>
                        <option value="open">Open Events</option>
                        <option value="closed">Closed Events</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="event-category">Category:</label>
                    <select id="event-category">
                        <option value="">All Categories</option>
                    </select>
                </div>
                <button id="fetch-natural-events" class="btn-primary">
                    <i class="fas fa-globe-americas"></i> Fetch Events
                </button>
            </div>
            <div class="data-table-container">
                <table id="natural-events-table" class="data-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Category</th>
                            <th>Status</th>
                            <th>Location</th>
                            <th>Date</th>
                            <th>GIBS Layers</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Simulation Tab -->
        <div id="simulation" class="tab-content">
            <div class="simulation-header">
                <h2><i class="fas fa-calculator"></i> Asteroid Impact & Deflection Simulation</h2>
                <p class="simulation-subtitle">Monte Carlo Process and Results Summary</p>
            </div>

            <!-- Simulation Purpose -->
            <div class="simulation-section">
                <h3><i class="fas fa-bullseye"></i> 1. Simulation Purpose</h3>
                <div class="purpose-card">
                    <div class="purpose-content">
                        <h4>Goal:</h4>
                        <p>To estimate how uncertainty in asteroid parameters (size, velocity) and defense actions (Δv, lead time) affects the impact location and Earth-hit probability.</p>
                        <p><strong>Methodology:</strong> Through random sampling and propagation calculations, we evaluate how uncertainties in asteroid physical parameters and defense strategies affect the final impact location and collision probability.</p>
                    </div>
                </div>
            </div>

            <!-- Simulation Setup -->
            <div class="simulation-section">
                <h3><i class="fas fa-cogs"></i> 2. Simulation Setup</h3>
                <div class="setup-table-container">
                    <table class="simulation-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Distribution</th>
                                <th>Range / Mean</th>
                                <th>Unit</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>diameter_m</code></td>
                                <td>Uniform</td>
                                <td>800 - 1400</td>
                                <td>m</td>
                                <td>Asteroid diameter</td>
                            </tr>
                            <tr>
                                <td><code>velocity_m_s</code></td>
                                <td>Normal</td>
                                <td>μ = 18000, σ = 2000</td>
                                <td>m/s</td>
                                <td>Incident velocity</td>
                            </tr>
                            <tr>
                                <td><code>delta_v_m_s</code></td>
                                <td>Normal</td>
                                <td>μ = 0.002, σ = 5e-4</td>
                                <td>m/s</td>
                                <td>Defense deflection velocity (Δv)</td>
                            </tr>
                            <tr>
                                <td><code>lead_years</code></td>
                                <td>Uniform</td>
                                <td>3 - 10</td>
                                <td>years</td>
                                <td>Defense lead time</td>
                            </tr>
                            <tr>
                                <td><code>noise</code></td>
                                <td>2D Gaussian</td>
                                <td>σx = 3, σy = 2</td>
                                <td>km</td>
                                <td>Observation and process noise</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="simulation-note">
                    <p><strong>Simulation size:</strong> N = 4000 runs → Each run represents a possible "asteroid defense scenario".</p>
                </div>
            </div>

            <!-- Monte Carlo Process -->
            <div class="simulation-section">
                <h3><i class="fas fa-random"></i> 3. Monte Carlo Process</h3>
                <div class="process-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Generate random inputs</h4>
                            <p>Generate random values for diameter (d), velocity (v), Δv, and lead time (L).</p>
                            <p><strong>Generate random inputs (diameter d, velocity v, Δv, lead time L)</strong></p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Add random noise</h4>
                            <p>Add random noise to represent observation & orbital perturbations.</p>
                            <p><strong>Add random noise to represent observation and orbital perturbations</strong></p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Compute impact point</h4>
                            <p>Calculate impact coordinates using simplified solver:</p>
                            <div class="equations">
                                <div class="equation">
                                    <code>x = 120 + 0.015d - 0.002v + 1.8×10⁵ Δv L + 1.5n₁</code>
                                </div>
                                <div class="equation">
                                    <code>y = -60 + 0.008d + 0.001v + 1.2×10⁵ Δv L + 1.2n₂</code>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Store results</h4>
                            <p>Store all (x, y) results as Impact Cloud.</p>
                            <p><strong>Store all (x, y) results as Impact Cloud</strong></p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>Statistical analysis</h4>
                            <p>Perform 4000 iterations to obtain statistical distribution.</p>
                            <p><strong>Perform 4000 iterations to obtain statistical distribution</strong></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Summary -->
            <div class="simulation-section">
                <h3><i class="fas fa-chart-line"></i> 4. Results Summary</h3>
                
                <div class="results-grid">
                    <div class="result-card">
                        <h4>① Maximum Likelihood Estimation (MLE)</h4>
                        <div class="result-data">
                            <p><strong>Mean (x, y) [km]:</strong> (2444.0, 1489.4)</p>
                            <p><strong>Covariance Σ:</strong> [[897668, 598340], [598340, 398839]]</p>
                            <p class="conclusion">→ Impact points are concentrated in an area approximately 2860 km from the reference origin.</p>
                        </div>
                    </div>

                    <div class="result-card">
                        <h4>② Bayesian Update</h4>
                        <div class="result-data">
                            <p><strong>Posterior Mean (x, y) [km]:</strong> (2443.8, 1489.4)</p>
                            <p><strong>Posterior Covariance Σ:</strong> [[0.002, 0.000], [0.000, 0.001]]</p>
                            <p><strong>Posterior P(hit Earth):</strong> ≈ 1.000000</p>
                            <p class="conclusion">→ Almost all posterior samples are within the Earth's radius of 6371 km.</p>
                        </div>
                    </div>

                    <div class="result-card">
                        <h4>③ Linear Regression Analysis (Sensitivity Analysis)</h4>
                        <div class="result-data">
                            <p><strong>Model:</strong> r km = β₀ + β₁d + β₂v + β₃Δv + β₄L</p>
                            <div class="coefficients">
                                <p><strong>Intercept:</strong> -2763 (p < 2e-16)</p>
                                <p><strong>diameter_m:</strong> 0.004 (p = 0.825)</p>
                                <p><strong>velocity_m_s:</strong> 0.0018 (p = 0.293)</p>
                                <p><strong>Δv:</strong> 1.405×10⁶ (p < 2e-16)</p>
                                <p><strong>lead_years:</strong> 430.4 (p < 2e-16)</p>
                            </div>
                            <p><strong>R² Value:</strong> 0.964</p>
                            <p class="conclusion">→ The model explains 96.4% of the impact point variation.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interpretation -->
            <div class="simulation-section">
                <h3><i class="fas fa-lightbulb"></i> 5. Interpretation</h3>
                <div class="interpretation-table">
                    <table class="simulation-table">
                        <thead>
                            <tr>
                                <th>Factor</th>
                                <th>Impact Direction</th>
                                <th>Explanation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="positive-correlation">
                                <td>Δv (Deflection Velocity)</td>
                                <td>Positive correlation ↑</td>
                                <td>The greater the deflection velocity, the farther the impact point shifts</td>
                            </tr>
                            <tr class="positive-correlation">
                                <td>Lead time</td>
                                <td>Positive correlation ↑</td>
                                <td>The earlier the defense is implemented, the more obvious the orbital change</td>
                            </tr>
                            <tr class="weak-correlation">
                                <td>Velocity</td>
                                <td>Weak correlation ↓</td>
                                <td>High-speed asteroids are more difficult to deflect</td>
                            </tr>
                            <tr class="no-impact">
                                <td>Diameter</td>
                                <td>Almost no impact</td>
                                <td>Affects energy but not trajectory geometry</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Key Takeaways -->
            <div class="simulation-section">
                <h3><i class="fas fa-key"></i> 6. Key Takeaways</h3>
                <div class="takeaways-list">
                    <div class="takeaway-item">
                        <div class="takeaway-icon">🎯</div>
                        <div class="takeaway-content">
                            <p><strong>Monte Carlo simulation (4000 runs)</strong> successfully constructed the impact probability distribution.</p>
                        </div>
                    </div>
                    <div class="takeaway-item">
                        <div class="takeaway-icon">📊</div>
                        <div class="takeaway-content">
                            <p><strong>Bayesian update</strong> significantly reduced uncertainty (prior → posterior).</p>
                        </div>
                    </div>
                    <div class="takeaway-item">
                        <div class="takeaway-icon">⚡</div>
                        <div class="takeaway-content">
                            <p><strong>Deflection velocity Δv</strong> and <strong>lead time</strong> are key variables.</p>
                        </div>
                    </div>
                    <div class="takeaway-item">
                        <div class="takeaway-icon">🚀</div>
                        <div class="takeaway-content">
                            <p>The model provides a stable analytical framework for future integration with the <strong>NASA NeoWs API</strong>.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prediction Tab -->
        <div id="prediction" class="tab-content">
            <div class="prediction-header">
                <h2><i class="fas fa-calculator"></i> Asteroid Impact Prediction</h2>
                <p>Simulate asteroid impact scenarios and analyze potential effects</p>
            </div>

            <div class="prediction-main">
                <!-- Left side - Asteroid Settings -->
                <div class="asteroid-settings">
                    <h3><i class="fas fa-asterisk"></i> Asteroid Properties</h3>
                    
                    <div class="control-group">
                        <label for="asteroid-select">Select Asteroid:</label>
                        <select id="asteroid-select">
                            <option value="">Choose an asteroid...</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label for="diameter">Diameter (m):</label>
                        <input type="range" id="diameter" min="10" max="2000" value="500" />
                        <span id="diameter-value">500 m</span>
                    </div>

                    <div class="control-group">
                        <label for="density-type">Density Type:</label>
                        <select id="density-type">
                            <option value="stony">Stony (3000 kg/m³)</option>
                            <option value="iron">Iron (7800 kg/m³)</option>
                            <option value="carbonaceous">Carbonaceous (2000 kg/m³)</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label for="mass-display">Mass:</label>
                        <div id="mass-display">Calculating...</div>
                    </div>

                    <h3><i class="fas fa-bullseye"></i> Impact Parameters</h3>
                    
                    <div class="control-group">
                        <label for="impact-lat">Latitude:</label>
                        <input type="number" id="impact-lat" min="-90" max="90" step="0.1" value="40.7128" />
                    </div>

                    <div class="control-group">
                        <label for="impact-lon">Longitude:</label>
                        <input type="number" id="impact-lon" min="-180" max="180" step="0.1" value="-74.0060" />
                    </div>

                    <div class="control-group">
                        <label for="velocity">Velocity (m/s):</label>
                        <input type="range" id="velocity" min="5000" max="50000" step="1000" value="15000" />
                        <span id="velocity-value">15.0 km/s</span>
                    </div>

                    <div class="control-group">
                        <label for="angle">Impact Angle (degrees):</label>
                        <input type="range" id="angle" min="10" max="90" step="5" value="45" />
                        <span id="angle-value">45°</span>
                    </div>

                    <div class="control-group">
                        <label for="target-type">Target Type:</label>
                        <select id="target-type">
                            <option value="continental_crust">Continental Crust</option>
                            <option value="oceanic_crust">Oceanic Crust</option>
                            <option value="ocean">Ocean</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <button id="run-simulation" class="btn-primary">
                            <i class="fas fa-play"></i> Run Simulation
                        </button>
                    </div>

                    <div id="simulation-progress" class="simulation-progress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                        <p>Calculating impact effects...</p>
                    </div>
                </div>

                <!-- Right side - Map and Results -->
                <div class="right-section">
                    <!-- Top Right - Impact Map -->
                    <div class="map-container">
                        <h3><i class="fas fa-map"></i> Impact Map</h3>
                        <div id="impact-map" class="impact-map"></div>
                    </div>

                    <!-- Bottom Right - Results -->
                    <div class="results-section">
                        <h3><i class="fas fa-chart-line"></i> Impact Analysis Results</h3>
                        <div id="outcome-cards" class="outcome-cards">
                            <div class="no-results">
                                <p>Run a simulation to see impact analysis results</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
